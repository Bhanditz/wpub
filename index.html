<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
	<head>
		<meta charset="utf-8" />
		<title>Web Publications</title>
		<script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove" defer="defer"></script>
		<script src="common/js/biblio.js" class="remove"></script>
		<link href="common/css/common.css" rel="stylesheet" type="text/css" />
		<script class="remove">
		  // <![CDATA[
          var respecConfig = {
              wg: "Publishing Working Group",
              specStatus: "ED",
              shortName: "wpub",
            //   edDraftURI: "https://w3c.github.io/wpub/",
              editors: [
                  {
      			      "name": "Matt Garrish",
                      "company": "DAISY Consortium",
                      "companyURL": "http://www.daisy.org",
                      "w3cid": 51655
                  },
                  {
                    "name": "Ivan Herman",
                    "url": "https://www.w3.org/People/Ivan/",
                    "company": "W3C",
					"w3cid": 7382,
                    "extras": [
                    {
                      "name": "<img src='common/images/orcid_logo.png' alt='orcid logo'/>",
                      "href": "http://orcid.org/0000-0003-0782-2704",
                      "class": "orcid"
                    }],
                    "companyURL": "http://www.w3.org",
                  }
              ],
			  authors: [
			      {
                    "name": "Baldur Bjarnason",
                    "company": "The Rebus Foundation",
                    "companyURL": "http://reb.us/",
					"w3cid": 92101
                  },
			  	  {
                    "name": "Timothy W. Cole",
                    "url": "http://www.library.illinois.edu/people/bios/t-cole3/",
                    "company": "University of Illinois at Urbana-Champaign",
                    "companyURL": "http://illinois.edu",
					"w3cid": 53965,
                    "extras": [
                      {
                        "name": "<img src='common/images/orcid_logo.png' alt='orcid logo'/>",
                        "href": "https://orcid.org/0000-0002-5906-4581",
                        "class": "orcid"
                      }]
                  },
			  ],
              processVersion: 2017,
              includePermalinks: true,
              permalinkEdge:     true,
              permalinkHide:     false,
              diffTool:          "http://www.aptest.com/standards/htmldiff/htmldiff.pl",
              wgURI:             "https://www.w3.org/publishing/groups/publ-wg/",
              wgPublicList:      "public-publ-wg",
              wgPatentURI:       "https://www.w3.org/2004/01/pp-impl/100074/status",
			  github:			 {
				  repoURL: "https://github.com/w3c/wpub",
				  branch: "master"

			  },
            //   otherLinks: [
            //       {
            //         key: "Repository",
            //         data: [{
            //             value: "Github Repository",
            //             href: "https://github.com/w3c/wpub"
            //         }]
            //       },
            //       {
            //         key: "Changes",
            //         data: [
            //         // {
            //         //   value: "Diff to previous version",
            //         //   href: "diff.html"
            //         // },
            //         {
            //           value: "Commit history",
            //           href: "https://github.com/w3c/wpub/commits/master"
            //         }]
            //       }
            //   ],
              localBiblio: biblio
          };
          // ]]>
      </script>
	</head>
	<body>
		<section id="abstract">
			<p>This specification defines a collection of information that describes the structure of Web Publications, so
				that user agents or developers may create user experiences well-suited to reading publications, such as
				sequential navigation and offline reading. This information includes the default reading order, a list of
				resources, and publication-wide metadata.</p>
		</section>
		<section id="sotd">
			<p>This first public working draft provides a preliminary outline of a Web Publication. Many details are under
				active consideration within the Publishing Working Group and are subject to change. The most prominent known
				issues have been identified in this document and links provided to comment on them.</p>

			<p>In particular, the Working Group seeks feedback on the following issues:</p>
			<ul>
				<li>...</li>
			</ul>
		</section>
		<section id="intro">
			<h2>Introduction</h2>

			<section id="background" class="informative">
				<h3>Background</h3>

				<p>For millenia now, the written word has been the primary means of encoding and sharing ideas and
					information. The publication as a bounded edition, made public, has been used to carry intellectual and
					artistic works of innumerable form: novels, plays, poetry, journals, magazines, newspapers, articles,
					laws, treatises, pamphlets, atlases, comics, manga, notebooks, memos, manuals, and albums of all
					sorts.</p>

				<p>More recently, with the advent of the information age, print has been ceding ground to digital, and the
					Web has become a major forum for the public dissemination of ideas. But the Web is unbounded: information
					and resources are only loosely connected through hyperlinks. While this model has helped the Web thrive
					in many areas, it has proven problematic for traditional information publishing—users often cannot access
					works in their entirety, especially when offline, and have not been able to easily access, compile and
					download content for curation and personal use. That, in turn, has fed the continuing development of
					non-Web document formats to redress these problems, and made it necessary to create both Web-ready
					content and alternative offline renditions to ensure publications are fully available.</p>

				<p>This specification aims to reduce these barriers and reinvigorate publishing by combining the best aspects
					of both models—the persistent availability and portability of bounded publications with the pervasive
					accessibility, addressability, and interconnectedness of the Open Web Platform.</p>
			</section>

			<section id="scope" class="informative">
				<h3>Scope</h3>

				<p>This specification only defines requirements for the production and rendering of valid <a>Web
						Publications</a>. As much as possible, it leverages existing Open Web Platform technologies to
					achieve its goal—that being to allow for a measure of boundedness on the Web without changing the way
					that the Web itself operates.</p>

				<p>Moreover, the specification is designed to adapt automatically to updates to Open Web Platform
					technologies in order to ensure that Web Publications continue to interoperate seamlessly as the Web
					evolves (e.g., by referencing the latest published versions instead of specific versions).</p>

				<p>Further, this specification does not attempt to constrain the nature of a Web Publication: any type of
					work that can be represented on the Web constitutes a potential Web Publication.</p>
			</section>

			<!-- <section id="nature">
				<h3>Web Publications</h3>

				<p>The act of publishing involves obtaining resources, organizing them into a publication and making that
					publication available on a Web server. In doing so, the publisher establishes the interconnectedness that
					binds the resources into a single work. This process also provides an origin for the Web Publication and
					a URL that uniquely identifies it, giving provenance to the work.</p>

				<p>The establishment of this discoverable and identifiable collection is what enables users to access their
					content without concern for whether they are online or offline. The user agent can cache the resources
					ensuring that the Web Publication is available and functional while offline, providing the user, as much
					as possible, a seamless experience interacting with a Web Publication regardless of their network
					connection.</p>

				<p>The Web Publication introduces the concept of a manifest, which serves to carry information about the
					constituent resources of the publication. The manifest includes metadata that describes the publication
					as a whole, as it has an identity and nature beyond its constituent resources. The metadata and manifest
					also incorporate information about the sequence and presentation of the content.</p>

				<p>A Web Publication also provides a default ordering of its primary constituent resources, although that
					order may be changed by user interaction or scripting. The user is able to access any primary resource
					directly via navigation provided by the publication itself or via the user agent.</p>
			</section> -->

			<section id="terminology">
				<h3>Terminology</h3>

				<p>Wherever appropriate, this document relies on terminology defined by the note on "Publishing and Linking
					on the Web" [[!publishing-linking]], including, in particular, <a class="externalDFN"
						href="https://www.w3.org/TR/publishing-linking/#dfn-user">user</a>, <a class="externalDFN"
						href="https://www.w3.org/TR/publishing-linking/#dfn-user-agent">user agent</a>, <a
						class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-browser">browser</a>, and <a
						class="externalDFN" href="https://www.w3.org/TR/publishing-linking/#dfn-address">address</a>.</p>

				<dl>
					<dt><dfn>Identifier</dfn></dt>
					<dd>
						<p>An identifier is metadata that can be used to refer to <a class="externalDFN"
								href="https://www.w3.org/TR/publishing-linking/#dfn-web-content">Web Content</a> in a
							persistent and unambiguous manner. URLs, URNs, DOIs, ISBNs, or PURLs are all examples of
							persistent identifiers frequently used in publishing.</p>
					</dd>

					<dt><dfn data-lt="Manifests">Manifest</dfn></dt>
					<dd>
						<p>A manifest represents structured information about a <a>Web Publication</a>, such as informative
							metadata, a <a href="#wp-resources">list of all resources</a>, and a <a>default reading
							order</a>.</p>
					</dd>

					<dt><dfn>Non-empty</dfn></dt>
					<dd>
						<p>For the purposes of this specification, non-empty is used to refer to an element, attribute or
							property whose text content or value consists of one or more characters after whitespace
							normalization, where whitespace normalization rules are defined per the host format.</p>
					</dd>

					<dt><dfn>URL</dfn></dt>
					<dd>
						<p>In this specification, the general term URL is used as in other W3C specifications like
							HTML&#160;[[!html]], and is defined by URL Standard of the WhatWG&#160;[[!url]]. In particular,
							such a URL allows for the usage of characters from Unicode following&#160;[[!rfc3987]]. See <a
								href="https://www.w3.org/TR/html/references.html#biblio-url">the note in the HTML5
								document</a> for further details.</p>
					</dd>

					<dt><dfn data-lt="Web Publications|Web Publication's">Web Publication</dfn></dt>
					<dd>
						<p>A Web Publication is a collection of one or more resources, organized together through a
								<a>manifest</a> into a single logical work with a <a>default reading order</a>. The Web
							Publication is uniquely identifiable and presentable using Open Web Platform technologies.</p>
					</dd>
				</dl>
			</section>
		</section>
		<section id="conformance">
			<section>
				<h2>Conformance Classes</h2>

				<p>This specification defines two conformance classes: one for <a>Web Publications</a> and one for user
					agents that process them.</p>

				<p id="wp-conformance">A Web Publication is conformant to this specification if it meets the following
					criteria:</p>

				<ul>
					<li>It MUST have a <a>manifest</a> that conforms to <a href="#manifest-req"></a>.</li>
				</ul>

				<p id="ua-conformance">A user agent is conformant to this specification if it meets the following
					criteria:</p>

				<ul>
					<li>It MUST be capable of generating a conforming <a href="#infoset">infoset</a> for a Web
						Publication.</li>
				</ul>
			</section>
		</section>
		<section id="infoset">
			<h2>Information Set</h2>

			<p class="ednote">The name "infoset" may change depending on feedback. Although this term has a different meaning
				for individuals familiar with XML, alternatives such as "properties" and "metadata" do not fully capture the
				nature or purpose. See <a href="https://github.com/w3c/wpub/issues/63">issue #63</a> for discussion.</p>

			<section id="infoset-expl">
				<h3>Explanation</h3>

				<p>A Web Publication is defined by a set of properties known as its <dfn data-lt="infoset">information
						set</dfn> (infoset). The infoset is both abstract and concrete. It is abstract in the sense that it
					represents a set of information that a user agent has to be able to compile about the Web Publication,
					but it also becomes concrete when the user agent creates an internal representation of the
					information.</p>

				<p>The infoset does not require a specific serialization. It is primarily compiled from a Web Publication's
						<a>manifest</a>, whose serialization requirements are defined in <a href="#manifest-serialization"
					></a>. It is therefore possible to express the same infoset via different manifests, although a Web
					Publication will only have one manifest.</p>

				<p>Although the manifest is the primary source of the infoset, some information may be obtained independent
					of it. For example, fallback rules for properties defined in the following subsections allow a user agent
					to compile information that the author has not provided in the manifest, whether as an intentional
					optimization or by accidental omission.</p>
			</section>

			<section id="infoset-req">
				<h3>Requirements</h3>

				<p>The Web Publication <a>infoset</a> MUST include the following information:</p>

				<ul>
					<li>The <a href="#wp-address">address</a> of the Web Publication.</li>
					<li>The <a href="#wp-resources">Web Publication resources</a>.</li>
					<li>The <a href="#wp-default-reading-order">default reading order</a> of the Web Publication.</li>
				</ul>

				<p>In addition, the infoset SHOULD include the following information:</p>

				<ul>
					<li>The <a href="#wp-title">title</a> (or "name") of the Web Publication.</li>
					<li>The <a href="#wp-language">default (natural) language</a> of the Web Publication.</li>
					<li>A <a href="#wp-canonical-identifier">canonical identifier</a>.</li>
					<li>The <a href="#wp-table-of-contents">table of contents</a>.</li>
				</ul>

				<p class="ednote">These requirements reflect the current minimum consensus, though a number of issues remain
					open that could change whether an item is required or recommended. See the following sections for more
					information.</p>

				<p class="issue" data-number="21">Whether the minimum manifest must include any metadata, or a specific slot
					to handle metadata. (Note: this is now more specifically related to the infoset.)</p>
			</section>

			<section id="wp-title">
				<h3>Title</h3>

				<p>The title provides the human-readable name of the Web Publication.</p>

				<p>When specified in the manifest, the title MUST be <a>non-empty</a>.</p>

				<p>If a user agent requires a title and one is not available in the <a>infoset</a>, it MAY create one. This
					specification does not mandate how such a title is created. The user agent might:</p>

				<ul>
					<li>use the first <a>non-empty</a>
						<code>title</code> element found in the <a>default reading order</a>;</li>
					<li>provide a language-specific placeholder title (e.g., 'Untitled Publication');</li>
					<li>use the URL of the manifest;</li>
					<li>calculate a title using its own algorithm.</li>
				</ul>

				<div class="note">
					<p>A user agent is not expected to produce a <a
							href="https://www.w3.org/TR/WCAG20/#navigation-mechanisms-title">meaningful title</a> [[WCAG20]]
						for a Web Publication when one is not specified.</p>
				</div>
			</section>

			<section id="wp-language">
				<h3>Language</h3>

				<p>The language specified in the Web Publication's <a>infoset</a> identifies the natural language(s) of its
					content.</p>

				<p>This language is not used in the processing or rendering of the Web Publication (including the manifest),
					and is <strong>not</strong> a replacement for identifying the language of each resource as defined by its
					format. It instead allows a user agent to ability to provide supplementary enhancements, such as the
					ability to download a custom dictionary or the preload a language-specific text-to-speech module.</p>

				<p>When specified, the language MUST be a tag that conforms to [[!BCP47]].</p>

				<p>If a user agent requires the language and one is not available in the infoset, it MAY attempt to determine
					the language. This specification does not mandate how such a language tag is created. The user agent
					might:</p>

				<ul>
					<li>use the <a>non-empty</a> language declaration of the manifest;</li>
					<li>use the first non-empty language declaration found in the <a>default reading order</a>;</li>
					<li>calculate the language using its own algorithm.</li>
				</ul>

				<p>If a language tag cannot be determined, the value "<code>und</code>" (undetermined) MUST be used.</p>

				<div class="issue" data-number="53">
					<p>The question is whether the language declared for the manifest content is the same as the language of
						the publication, and how to deal with multilingual publications.</p>
				</div>
			</section>

			<section id="wp-canonical-identifier">
				<h3>Canonical Identifier</h3>

				<p>A <a>Web Publication's</a>
					<dfn>canonical identifier</dfn> is a unique identifier that resolves to the preferred version of the Web
					Publication. The canonical identifier SHOULD be an <a>address</a>, but, if not, it MUST be possible to
					make a one-to-one mapping to an address (e.g., a DOI can be resolved to a URL via a DOI resolver).</p>

				<p>If a Web Publication is hosted at more than one address, this identifier allows a user agent to identify
					the shared relationship between the versions and to determine which of the available addresses is
					primary.</p>

				<p>The canonical identifier is also intended to provide a measure of permanence above and beyond the Web
					Publication's address. Even if a Web Publication is permanently relocated to a new address, for example,
					the canonical identifier will provide a way of locating the new location (e.g., a DOI registry could be
					updated with the new URL, or a redirect could be added to the URL of the canonical identifier).</p>

				<p>When assigned, the canonical identifier needs to be unique to one and only one Web Publication,
					independent of its address(es). Ensuring uniqueness is outside the scope of this specification, however.
					The actual uniqueness achievable depends on such factors as the conventions of the identifier scheme used
					and the degree of control over assignment of identifiers.</p>

				<p class="note">If the canonical identifier is a URL, it can be used as the target of a "canonical"
					link&#160;[[!rfc6596]] (e.g., a [[html]] <code>link</code> element whose <code>rel</code> attribute has
					the value <code>canonical</code> or a Link HTTP header field [[rfc5988]] similarly identified).</p>

				<p class="issue" data-number="58">The question is whether a canonical identifier is necessary to call out
					explicitly in the infoset, or whether it is/can be handled by other metadata.</p>
			</section>

			<section id="wp-address">
				<h3>Address</h3>

				<p>A Web Publication's <dfn>address</dfn> is a <a>URL</a> that refers to a <a>Web Publication</a> and enables
					the retrieval of a representation of the <a>manifest</a> of the Web Publication.</p>

				<p>The availability of this address does not preclude the creation and use of other identifiers and/or
					addresses to retrieve a representation of a <a>Web Publication</a> in whole or part.</p>

				<div class="note">The Web Publication's address can also be used as value for an identifier link relation
					[[link-relation]].</div>
			</section>

			<section id="wp-resources">
				<h3>Resources</h3>

				<p>The <a>infoset</a> MUST include a list of the Web Publication's resources, although the list is not
					required to be exhaustive. Resources in the <a>default reading order</a> MUST be included in this
					list.</p>

				<p class="issue" data-number="22">The discussion led to the question whether the manifest/infoset MUST list
					all resources or not. In this sense, this became a duplicate of <a
						href="https://github.com/w3c/wpub/issues/23">issue #23</a> ended up at the same question.</p>

				<p class="issue" data-number="23">The question is whether the manifest/infoset MUST list all resources or
					not.</p>

				<p class="issue" data-number="59">The question is whether the manifest MUST list resources in the default
					reading order or whether this can be inferred.</p>
			</section>

			<section id="wp-default-reading-order">
				<h3>Default Reading Order</h3>

				<p>The <dfn>default reading order</dfn> is a specific progression through a set of Web Publication
					resources.</p>

				<p>A user might follow alternative pathways through the content, but in the absence of such interaction the
					default reading order defines the expected progression from one resource to the next.</p>

				<p>The default reading order MUST include at least one resource.</p>

				<p>The default reading order is either specified directly in the manifest or a link is provided to an
					[[!html]] <code>nav</code> element whose list of links are processed to create one.</p>

				<p>The process for extracting a default reading order from a <code>nav</code> element are as follows:</p>

				<ol>
					<li>extract a list of resource paths referenced from the <code>href</code> attribute of all
							<code>a</code> elements;</li>
					<li>strip any fragment identifiers from the references;</li>
					<li>resolve all relative paths to full URLs;</li>
					<li>remove all consecutive references to the same resource, leaving only the first.</li>
				</ol>

				<p>If a user agent requires a default reading order and one is not provided in the <a>infoset</a>, it MAY
					attempt to construct one. This specification does not mandate how such a default reading order is
					created. The user agent might:</p>

				<ul>
					<li>use only the resource the user accessed to reach the manifest;</li>
					<li>search the list of resources for a <code>nav</code> element to use;</li>
					<li>calculate the default reading order using its own algorithm.</li>
				</ul>

				<p class="issue" data-number="35">Define the default reading order of a Web Publication to be the files
					referenced in the first</p>
				<p class="issue" data-number="39">There is a consensus that a Web Publication must have a reading order and
					must/should have a table of contents (the main navigation entry point).</p>
			</section>

			<section id="wp-table-of-contents">
				<h3>Table of Contents</h3>

				<p>The table of contents provides access to major sections of the Web Publication. There are no requirements
					on the completeness of the table of contents, except that, when specified, it MUST link to at least one
					resource in the <a>default reading order</a>.</p>

				<p>The table of contents is either specified directly in the manifest or a link is provided to an [[!html]]
						<code>nav</code> element containing one.</p>

				<p>If a user agent requires a table of contents and one is not specified, it MAY construct one. This
					specification does not mandate how such a table of contents is created. The user agent might: </p>

				<ol>
					<li>attempt to locate a table of contents in the default reading order (e.g., an HTML document with a
							<code>nav</code> element that has the <code>role</code> attribute value
						<code>doc-toc</code>);</li>
					<li>use the titles of resources in the default reading order;</li>
					<li>calculate a table of contents using its own algorithms.</li>
				</ol>

				<p class="issue">This question arises only if this mechanism is accepted: the question is whether a table of
					contents navigation element can refer, via links, to any resource that is <em>not</em> listed in the
					default reading order.</p>

				<p class="ednote">The issue of using the HTML <code>nav</code> element as a possible encoding of the table of
					contents is mentioned or explicitly addressed in a number of issues listed below.</p>

				<p class="issue" data-number="35">Define the resources in the default reading order of a Web Publication to
					be the files referenced in the first</p>
				<p class="issue" data-number="39">There is a consensus that a Web Publication must have a reading order and
					must/should have a table of contents (the main navigation entry point).</p>
			</section>
			<section id="wp-metadata">
				<h3>Additional Metadata</h3>
				<p>In addition the stated requirements the Web Publication Infoset SHOULD also provide the following
					publication metadata:</p>
				<ul>
					<li>A list of creators and, optionally, their specific roles. E.g. 'author', 'publisher', 'editor', or
						'translator'.</li>
					<li>Publication date</li>
					<li>Modification date</li>
					<li>Accessibility metadata</li>
				</ul>

				<p>Identifiers and modification dates are an important aid in the distribution and storage of portable
					formats (past, current, and present) so authors are urged to include this information whenever they
					can.</p>

				<p class="issue" data-number="73"></p>

				<p>The infoset MAY also provide:</p>

				<ul>
					<li>A subtitle</li>
					<li>Licensing information</li>
					<li>Intended audience</li>
					<li>General subject</li>
				</ul>

				<p>These items apply to the Web publication in its entirety. Metadata for individual content documents should
					be embedded in or linked from the content documents themselves.</p>

				<p>The Web Publication Infoset SHOULD NOT include complex, specialised, and industry-specific metadata and
					authors should limit the metadata included in the manifest to the items above.</p>

				<p>If the information set does not cover the publication's needs, authors should link to external metadata
					files in whichever formats and schema are most commonly accepted as the authoritative metadata format for
					their intended audiences. They can include multiple metadata links in multiple formats, one for each
					intended audience, if needed.</p>

				<p>User Agents MAY decide to support metadata extensions, other metadata schemes, or additional metadata
					properties if they so choose. User Agents must ignore metadata properties that they do not recognise.</p>

			</section>
		</section>
		<section id="manifest">
			<h2>Manifest</h2>

			<section id="manifest-intro" class="informative">
				<h3>Overview</h3>

				<p>A <a>manifest</a> is a specific serialization of a <a>Web Publication's</a>
					<a>infoset</a>.</p>
			</section>

			<section id="manifest-req">
				<h3>Requirements</h3>

				<p>The requirements for a conforming Web Publication manifest are as follows:</p>

				<ol>
					<li>It MUST <a href="#manifest-declaration">declare</a> that it describes a Web Publication.</li>
					<li>It MUST be serialized as defined in <a href="#manifest-serialization"></a>.</li>
				</ol>
			</section>

			<section id="manifest-declaration">
				<h3>Declaration</h3>

				<div class="ednote">Placeholder for how a manifest declares it describes a web publication.</div>
			</section>

			<section id="manifest-serialization">
				<h3>Serialization</h3>

				<p class="issue" data-number="25"></p>
				<p class="issue" data-number="26">Should the table of contents be a separate HTML file or is the listing of
					resources in the default reading order an implicit table of contents?</p>
				<p class="issue" data-number="32"></p>
			</section>

			<section id="manifest-linking">
				<h2>Linking to a Manifest</h2>

				<div class="ednote">Placeholder for how resources identify they belong to a publication.</div>

				<p class="issue" data-number="13">If we have a collection of information about a web publication as a whole
					("manifest") that exists separately from most of the publication's resources, we need to find a way to
					associate the manifest with the other publication resources.</p>
			</section>

			<section id="manifest-linking-from">
				<h3>Linking <em>from</em> a Manifest</h3>

				<p>The manifest serialization MUST provide a general linking mechanism for defining a relationship between
					the Web Publication and other resources on the Web as well as the type of those relationships.</p>

				<p>This mechanism is used in to express many parts of the Web Publication's infoset, including but not
					limited to:</p>

				<ul>
					<li><a href="#wp-canonical-identifier">Canonical identifier</a> using the <code>rel='canonical'</code>
						link relation.&#160;[[rfc6596]]</li>
					<li><a href="#wp-table-of-contents">Table of Contents</a> in the cases where the ToC is specified as a
						link to an HTML nav element.</li>
					<li><a href="#wp-metadata">External metadata</a> that may be expressed in established vocabularies such
						as ONIX, MARC, schema.org, or Dublin Core.</li>
				</ul>

				<p class="ednote">There are some overlaps between this list and, e.g., the separate section on canonical
					identifiers.</p>

				<p>This linking mechanism may also be used to express other common link structures on the open Web. For
					example:</p>

				<ul>
					<li>Distribution feeds such as <a href="http://opds-spec.org/specs/opds-catalog-1-1">OPDS</a> or <a
							href="https://tools.ietf.org/html/rfc4287">Atom</a>&#160;[[rfc4287]]</li>

					<li>Alternate versions of the publication</li>
					<li><a href="https://www.w3.org/TR/webmention/">Web Mentions</a>&#160;[[webmention]]</li>
				</ul>

				<p class="note">Some of these link structures, such as dynamic search links, may require support for <a
						href="https://tools.ietf.org/html/rfc6570">URI templates</a>&#160;[[rfc6570]] to be meaningfully
					useful in the context of a Web Publications. User agents should(?) support URI templates in order to make
					it easier for publishers to integrate dynamic server-side features into their publications with minimal
					coding and effort.</p>

				<p class="issue" data-number="67"></p>
			</section>
		</section>
		<section id="lifecycle">
			<h2>Establishing a Web Publication</h2>

			<p class="issue" data-number="32">Need to determine intersection between web pubs and the lifecycle of a web
				app.</p>

			<section id="lifecyle-obtain-manifest">
				<h3>Obtaining the manifest</h3>

				<p class="ednote">Placeholder for UA discovering and obtaining a manifest.</p>
			</section>

			<section id="lifecycle-process-manifest">
				<h3>Processing the manifest</h3>

				<p class="ednote">Placeholder for UA processing of manifest and creation of infoset.</p>
			</section>

			<section id="lifecycle-intiate-wp">
				<h3>Intiating the Web Publication</h3>

				<p class="ednote">Placeholder for UA initiating an enhanced reading experience.</p>
			</section>

			<section id="lifecycle-update-wp">
				<h3>Updating the Web Publication</h3>

				<p class="ednote">Placeholder for UA updating manifest and/or WP content.</p>
			</section>
		</section>
		<section id="wp-enhancements">
			<h2>Reading Enhancements</h2>

			<p class="ednote">This section contains placholders for possible reading enhancements the UA may/should/must
				provide. The list is subject to addition, modification and removal as the enhancements get discussed in more
				detail.</p>

			<section id="enh-nav">
				<h3>Navigation</h3>

				<section id="enh-reading-order">
					<h4>Reading Order</h4>

					<p class="ednote">Placeholder for automatic progression through the default reading order.</p>
				</section>

				<section id="enh-toc">
					<h4>Table of Contents</h4>

					<p class="ednote">Placeholder for accessing a table of contents.</p>
				</section>
			</section>

			<section id="enh-offline-reading">
				<h3>Offline Reading</h3>

				<p class="ednote">Placeholder for offline reading of a publication.</p>
			</section>

			<section id="enh-search">
				<h3>Search</h3>

				<p class="ednote">Placeholder for inter-publication search.</p>
			</section>

			<section id="enh-pagination">
				<h3>Pagination</h3>

				<p class="ednote">Placeholder for paginated reading experience.</p>
			</section>
<section id="enh-locators">
    <h3>Internal Locators</h3>

    <p>In addition to the URL(s) that is a Web Publication's address(es), bookmarking, annotation,
        and several other common use cases require internal locators, i.e., additional URLs, which
        can be used to identify, locate/retrieve, and/or reference content fragments and locations
        within a Web Publication (cf. Web Publications Use Cases and Requirements [[pwp-ucr]] and
        Digital Publishing Annotation Use Cases [[dpub-annotation-uc]]). The creator(s) of a Web
        Publication may provide internal locators and/or include structures that facilitate the
        minting of internal locators. In addition, as described in this section, user agents may
        mint other internal locators as needed, post-publication.</p>

    <section id="enh-intrinsicLocators">
        <h4>Publisher-Provided Locators</h4>
        <p>In choosing to organize a Web Publication into multiple, individually addressable
            resources, each with its own URL, the creator(s) of a Web Publication provides locators
            for individual objects encompassed by the publication. Thus Web Publication Resource
            URLs serve as Web Publication internal locators for directly identifying, retrieving,
            and/or referencing these constituent resources. </p>

        <p>Within a single Web Publication Resource, the creator of that resource may further
            provide anchors or other structures (e.g., the value of an <code>id</code> attribute of
            a <code>&lt;p&gt;</code> element in an HTML constituent resource, the Document Object
            Model (DOM) of an XML constituent resource) as a way to facilitate identifying,
            locating/retrieving, and/or referencing locations and more granular content fragments
            within that resource and thereby within the Web Publication. In particular, some
            intra-resource, publisher-provided anchors and structures of this sort may be used to
            mint fragment identifiers, as described below. </p>
    </section>

    <section id="enh-otherFragIds">
        <h4>Fragment Identifiers</h4>

        <p>The generic syntax for fragment identifiers is defined in RFC 3986 [[!rfc3986]]. The
            fragment identifier component of a URL comes at the end of the URL and is preceded by a
                <code>#</code> character. The fragment identifier component of a URL is separated
            prior to dereferencing and is not sent to the server. The identifying information within
            the fragment identifier component itself is dereferenced solely by the user agent.
            Interpretation and resolution of the fragment identifier may be dependent on the
            media-type of the resource retrieved when the preceding  part of the URL is
            dereferenced. </p>

        <p>A broad range of fragment identifier formats, each specific to resources of one or more
            media-types, have been defined in various IETF RFCs, W3C Recommendations, etc. These are
            typically included by reference in IANA-registered media-type specifications
            [[iana-media-types]]. A fragment identifier of a format appropriate for a Web
            Publication Resource's media type may be used to identify, retrieve, and/or reference
            content fragments within that resource.</p>

        <div class="ednote">
            <p>Could reference or duplicate here with modifications the second table from 4.2.1 of
                Web Anno Data Model Rec. [[!annotation-model]].</p>
        </div>

        <p>User agents minting fragment identifiers may take advantage of publisher-provided anchors
            and structures. For example, the value of the <code>id</code> attribute of a
                <code>&lt;p&gt;</code> element in an HTML Web Publication Resource can be used to
            mint a fragment identifier linking to that <code>&lt;p&gt;</code> element (i.e., a
            paragraph). This type of fragment identifier is illustrated in Example 1 which assumes
            the existence within the HTML resource of an element with id p33, e.g., <code>&lt;p
                id="p33"&gt;</code>.</p>
        <div class="example">
            <div class="example-title marker">
                <span>Example 1</span>
                <span style="text-transform: none">: A simple fragment identifier</span>
            </div>
            <pre class="nohighlight" id="example1">https://dauwhe.github.io/html-first/HeatRadiation/OPS/s009-Chapter-001.html#p33</pre>
        </div>

        <p>Using other formats, user agents may still mint fragment identifiers to serve as Web
            Publication internal locators even in the absence of any explicit publisher-provided
            anchor or structure. For example, a media fragment identifier [[!media-frags]] for a
            still image may be minted without reference to a pre-coordinated anchor or structure, as
            shown in Example 2. In this example, the fragment is a rectangular image segment that is
            200x150 pixels with its upper left corner at 100 pixels in from the left edge and 500
            pixels down from the top edge of the full image.</p>
        <div class="example">
            <div class="example-title marker">
                <span>Example 2</span>
                <span style="text-transform: none">: A media fragment identifier</span>
            </div>
            <pre class="nohighlight" id="example2">http://zebu.uoregon.edu/hudf/hudf_300dpi.jpg#xywh=100,500,200,150</pre>
        </div>
    </section>

    <section id="enh-locateFragIds">
        <h4>The <code>locate</code> Fragment Identifier</h4>

        <p>For some use cases it is essential to identify and reference a location in or a fragment
            of a resource in the scope of a larger construct, such as a Web Publication, which
            includes this resource in some fashion. The fragment identifier approaches described
            above do not satisfy this requirement since only the URL of the constituent resource
            containing the location or content fragment of interest is expressed. Additionally,
            existing fragment identifier formats have limitations with respect to known
            publishing-related use cases (e.g., Media Fragments 1.0 only supports rectangular
            spatial selections), and a creator cannot anticipate all the content fragments and
            locations within a Web Publication that will need to be identified and made
            referenceable. An alternative approach that largely mitigates these concerns and is
            useful for many use cases of interest, is the <code>locate</code>  Fragment Identifier
            (LFI) format which is defined here. </p>

        <p>A LFI may be constructed and appended to the URL of a web resource, including resources
            containing or logically comprised of other resources. For example, a LFI may be appended
            to a Web Publication canonical identifier as a means to identify a location or content
            fragment in the context and scope of that Web Publication. The canonical identifier of
            the Web Publication must not already include another fragment identifier. The LFI must
            conform to the semantics described here, which are a mapping and extension of the Web
            Annotation Data Model [[!annotation-model]] and Vocabulary [[!annotation-vocab]] for
            describing a <code>SpecificResource</code>. The mapping of these semantics into a syntax
            conformant to that required by RFC 3986 for fragment identifiers was inspired by the
            Selectors and States Working Group Note [[selectors-states]]. Additional semantics and
            extensions inspired in part by the EPUB 3.1 Canonical Fragment Identifier [[cfi]],
            a Recommended Specification of the IDPF.</p>

        <p>The syntax of a LFI follows a "functional" paradigm, <code>#locate(...)</code>, similar
            to the syntax used, for example, by the XPointer Framework. The allowable "parameters"
            and their usage are described below. Note that the URL encoding for some of the examples
            below is incomplete and for some examples below line breaks have been introduced. This
            has been done for greater readability; in real usage URL encoding should be complete and
            new line characters are not allowed in a URL.</p>

        <section id="enh-lfiSelector">
            <h5>The <code>selector</code> parameter</h5>
            <p>A <code>selector</code> parameter describes a Selector which expresses the property
                values necessary to locate a fragment of interest within a resource.
                    <code>selector</code> parameter syntax is also functional, i.e.,
                    <code>selector(...)</code>. There are 8 types of Selectors, each illustrated
                below, and each Selector must include a <code>type</code> parameter with a single
                value matching the name of one of these 8 <code>types</code> as enumerated below. As
                the methods used to describe fragment locations vary by Selector type and by
                media-type of the resource involved, the other parameters required or allowed for a
                Selector, will vary accordingly. LFI Selector semantics are as described in the Web
                Annotation Data Model [[!annotation-model]] and Vocabulary [[!annotation-vocab]]
                unless otherwise noted below. In some case more than one type of Selector can be
                used to identify the same content fragment, albeit in different ways and using
                different parameters; however, the <code>selector</code> parameter is not
                repeatable, i.e., must not appear more than once within a single LFI. When more than
                one Selector is available to identify the fragment of interest, the user agent must
                choose only one. (This is a restriction of the Web Annotation Data Model definition
                for a <code>selector</code>.)</p>

            <p><code>FragmentSelector</code>: Other formats of fragment identifiers can be expressed
                using the <code>selector</code> parameter. In Example 3, the media fragment
                identifier from Example 2 is described by the <code>selector</code> shown. Note the
                required URL character encoding of the '=' and ',' characters in the
                    <code>value</code> parameter of the <code>selector</code></p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 3</span>
                    <span style="text-transform: none">: A <code>FragmentSelector</code></span>
                </div>
                <pre class="nohighlight" id="example3">http://zebu.uoregon.edu/hudf/hudf_300dpi.jpg#locate(selector(type=FragmentSelector,conformsTo=http://www.w3.org/TR/media-frags,
              value=xywh%3D100%2C500%2C200%2C150))</pre>
            </div>

            <p><code>CSSSelector</code>: One of the most common ways to identify elements in an HTML
                or XML resource is to use CSS Selectors [[!CSS3-selectors]]. Selectors of type
                    <code>CSSSelector</code> rely on publisher-furnished intrinsic locators within a
                resource, e.g., class and id attributes associated with elements in the Document
                Object Model (DOM). A <code>CSSSelector</code> may only be applied to a resource
                representation that is DOM conformant. Example 4 uses a <code>CSSSelector</code> to
                locate the same <code>&lt;p&gt;</code> element identified in Example 1</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 4</span>
                    <span style="text-transform: none">: A <code>CSSSelector</code></span>
                </div>
                <pre class="nohighlight" id="example4">https://dauwhe.github.io/html-first/HeatRadiation/OPS/s009-Chapter-001.html#locate(selector(type=CSSSelector,
              value=%23p33))</pre>
            </div>
            <div class="note">
                <p>Implementers should use only commonly supported features of CSS that directly
                    contribute to selection of an element or content, rather than styling or
                    transformation, in order to maximize interoperability between systems.</p>
            </div>

            <p><code>XPathSelector</code>: Another common method of selecting elements and content
                within an XML or HTML resource that supports the Document Object Model is to use an
                XPath selection [[!DOM-Level-3-XPath]].</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 5 </span>
                    <span style="text-transform: none">: A <code>XPathSelector</code></span>
                </div>
                <pre class="nohighlight" id="example5">https://dauwhe.github.io/html-first/MobyDickNav/html/introduction.html#locate(selector(type=XPathSelector,
              value=/html/body/main/div/div/p[1]))</pre>
            </div>
            <div class="note">
                <p>Implementers should note that the <a
                        href="https://www.w3.org/TR/html5/syntax.html#optional-tags">HTML5
                        specification</a> allows parsers to add elements into the DOM that are
                    considered to be missing. XPaths should be constructed to include these
                    elements, rather than from the element structure in the document.</p>
            </div>

            <p><code>TextQuoteSelector</code>: This Selector describes a range of text within a
                resource by copying the full sequence of characters in the range, and additionally
                including a bit of the text immediately before (a prefix) and after (a suffix) the
                range (to help distinguish from occurrences of the same sequence of characters
                elsewhere in the resource).</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 6</span>
                    <span style="text-transform: none">: A <code>TextQuoteSelector</code></span>
                </div>
                <pre class="nohighlight" id="example6">https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html#locate(selector(type=TextQuoteSelector,exact=higgledy-piggledy,prefix=at%20least%2C%20take%20the%20,suffix=%20whale%20statements%2C%20however))</pre>
            </div>
            <p>The selection of the range of text of interest must be in terms of Unicode code
                points (the "character number"), not in terms of code units (that number expressed
                using a selected data type). Selections should not start or end in the middle of a
                grapheme cluster. The selection must be based on the <a
                    href="https://www.w3.org/International/questions/qa-visual-vs-logical">logical
                    order</a> of the text, rather than the visual order (critical for bidirectional
                text). For more information about the general character model of text used on the
                web, see the Character Model for the World Wide Web [[charmod]].</p>
            <p>The text must be normalized before creating a Selector of this kind. Thus HTML/XML
                tags should be removed, and character entities should be replaced with the character
                that they encode. Note that this does not affect the state of the content of the
                document containing the fragment of interest, only the way that the fragment is
                described.</p>
            <p>If, after processing the prefix, exact, and suffix, the user agent discovers multiple
                matching text sequences, then the selection should be treated as matching all of the
                matches.</p>
            <div class="note">
                <p>If the content is under copyright or has other rights asserted on its use, then
                    this method of selecting text is potentially dangerous. A user might select the
                    entire text of the document, which would not be desirable to copy into the LFI
                    and share. For static texts with access and/or distribution restrictions, the
                    use of the <code>TextPositionSelector</code> is perhaps more appropriate.</p>
            </div>
            <div class="note">
                <p>This Selector is also constrained by limits on URL length (which currently vary
                    by user agent and server). For long fragments the use of the
                        <code>TextPositionSelector</code> is more appropriate.</p>
            </div>

            <p><code>TextPositionSelector</code>: This Selector describes the location of a range of
                text in a resource by recording the start and end positions of the range in the
                resource. Position 0 would be immediately before the first character of the
                resource, position 1 would be immediately before the second character, and so on.
                Position n (where n is the total count of characters in the resource) would be
                immediately after the last character. Required parameters for this Selector are
                    <code>start</code> and <code>end</code>. The <code>start</code> character is
                thus included in the fragment, but the <code>end</code> character is not. For
                example, if the text of the resource was "abcdefghijklmnopqrstuvwxyz", the start was
                4, and the end was 7, then the selected range of text would be "efg".</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 7</span>
                    <span style="text-transform: none">: A <code>TextPositionSelector</code></span>
                </div>
                <pre class="nohighlight" id="example7">https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html#locate(selector(type=TextPositionSelector,start=387,end=404))</pre>
            </div>
            <p>The text must be normalized in the same way as for the <code>TextQuoteSelector</code>
                before counting the number of characters to determine the <code>start</code> and
                    <code>end</code> positions.</p>

            <p><code>DataPositionSelector</code>: Similar to the <code>TextPositionSelector</code>
                but working at the level of bytes in the stream rather than characters in the
                normalized text. Since references are to positions in the resource representation as
                a stream of bytes, normalization is not required.</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 8</span>
                    <span style="text-transform: none">: A <code>DataPositionSelector</code></span>
                </div>
                <pre class="nohighlight" id="example8">https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html#locate(selector(type=DataPositionSelector,start=974,end=991))</pre>
            </div>

            <p><code>SVGSelector</code>: An <code>SvgSelector</code> defines an area through the use
                of the Scalable Vector Graphics standard [[!SVG11]]. This allows the user agent to
                select a fragment of an image or other visual media resource, such as a circle or
                polygon, by describing the region of interest using SVG. The SVG (i.e., as provided
                using the <code>value</code>  parameter) may be either included (as a fragment of
                well-formed XML) or referenced as an external web resource (in which case an
                    <code>id</code> parameter with a URL value is provided instead of a
                    <code>value</code> parameter).</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 9</span>
                    <span style="text-transform: none">: A <code>SVGSelector</code></span>
                </div>
                <pre class="nohighlight" id="example9">http://zebu.uoregon.edu/hudf/hudf_300dpi.jpg#locate(selector(type=SVGSelector,
              value=&lt;svg%20xmlns%3D"%http://www.w3.org/2000/svg22&gt;&lt;circle%20cx%3D"200"%20cy%3D"575"%20r%3D"100"%20%2F&gt;&lt;%2Fsvg&gt;))</pre>
            </div>

            <p>
                <code>RangeSelector</code>: This selector is used to identify the beginning and the
                end of the content fragment of interest using other Selectors. In this way, the
                beginning and end points of a fragment can each be accurately identified using the
                most appropriate type of Selector, and then linked together to form the fragment.
                The fragment consists of everything from the beginning of the starting Selector
                through to the beginning of the ending Selector, but not including the latter. In
                Example 10, the fragment would include paragraphs <code>p33</code>,
                <code>p34</code>, and <code>p35</code>, but not <code>p36</code>.</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 10</span>
                    <span style="text-transform: none">: A <code>RangeSelector</code></span>
                </div>
                <pre class="nohighlight" id="example10">https://dauwhe.github.io/html-first/HeatRadiation/OPS/s009-Chapter-001.html#locate(selector(type=RangeSelector,
                    selector(type=CSSSelector,value=%23p33),
                    selector(type=CSSSelector,value=%23p36)))</pre>
            </div>
        </section>

        <section id="enh-lfiSource">
            <h5>The <code>source</code> parameter</h5>
            <p>The Web Annotation Data Model [[!annotation-model]] anticipates the need in certain
                use cases to identify a content fragment from one resource in the context or scope
                of an encompassing resource, e.g., identifying  a region of a still image resource in
                the context of a web page in which the image has been embedded. Two properties,
                    <code>source</code> and <code>scope</code>, both taking URLs as values, are used
                to differentiate between the address of the resource containing the location or
                content fragment of interest (the <code>source</code> URL) and the address of an
                encompassing (or otherwise context-providing) resource (the <code>scope</code> URL). </p>
            <p>In a LFI (and a restriction on the semantics defined for these properties in the Web
                Annotation Data Model and Vocabulary), the use of these two properties is
                constrained as follows:</p>
            <ul>
                <li><code>scope</code> is always implicit and so must not appear as a parameter in
                    any LFI</li>
                <li><code>source</code> may be implicit or may be explicit and so may appear as a
                    parameter in a LFI</li>
                <li>If <code>source</code> appears as a parameter its value must be a single, valid
                    URL, e.g., <code>source=https://example.com/MyWebPub.wpub</code></li>
                <li>Neither property is repeatable, and so the <code>source</code> parameter must
                    not appear more than once in a single LFI</li>
                <li>User agents should recognize the URL to which the LFI is appended as the value
                    of <code>scope</code></li>
                <li>In the absence of a <code>source</code> parameter in an LFI, a user agent should
                    also recognize the URL to which the LFI is appended as the value of
                        <code>source</code></li>
            </ul>
            <p>In Example 11, the <code>scope</code> of the LFI is the canonical identifier of Web
                Publication, i.e., represented here as
                https://dauwhe.github.io/html-first/MobyDick.wpub. The text fragment of interest,
                however, is obtained by dereferencing the <code>source</code> URL, which is provided
                explicitly as https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html,
                and then selecting characters 387 to 404 of the normalized text of the
                representation returned. In other words, the text fragment of interest is contained
                within the scope of the Web Publication, but more specifically it is found within
                the representation of the Web Publication Resource, epigraph.html, as retrieved. </p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 11</span>
                    <span style="text-transform: none">: A <code>TextPositionSelector</code> with a
                            <code>source</code> parameter</span>
                </div>
                <pre class="nohighlight" id="example11">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(source=https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html,selector(type=TextPositionSelector,start=387,end=404))</pre>
            </div>
            <p>This ability to include the address of the Web Publication can be useful for example
                when referencing a fragment from a Web Publication Resource that is used in more
                than one Web Publication. Thus the same HTML instance of a poem (a Web Publication
                Resource) might appear both as part of a collection of poetry Web Publication and as
                the epigraph of a novel disseminated as a Web Publication. Having the ability to
                express both <code>source</code> and <code>scope</code> makes it possible to mint a
                URL for a line from the poem referenced as part of the collection of poetry that is
                distinguishable  from the URL for the same line from the poem referenced as a part of
                the novel.</p>
            <p>The <code>source</code> parameter may be used on its own (e.g., without a
                    <code>select</code> parameter) as a way to identify or reference an entire Web
                Publication Resource in the context of a Web Publication of which the resource is a
                constituent. In Example 12, the whole of Moby Dick's epigraph is being referenced as
                a constituent part of the Moby Dick Web Publication.</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 12</span>
                    <span style="text-transform: none">: A <code>source</code> parameter on its
                        own</span>
                </div>
                <pre class="nohighlight" id="example12">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(source=https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html)</pre>
            </div>
            <div class="note">
                <p>This approach using <code>source</code> and <code>scope</code> will require user
                    agents to dereference the <code>source</code> URL in addition to (or optimally,
                    instead of) dereferencing the URL to which the LFI is appended. This is a
                    different expectation than for other formats of Fragment Identifiers (and may
                    have performance and/or security implications?).</p>
            </div>
        </section>

        <section id="enh-lfiState">
            <h5>The <code>state</code> parameter</h5>
            <p>The <code>state</code> parameter provides information useful for retrieving a
                specific representation of a resource. As with <code>select</code>, the syntax is
                functional, i.e., <code>state(...)</code>. There are two types of States, and each
                description of a State must include a <code>type</code> parameter with a single
                value matching the name of one of these <code>types</code> as enumerated below. The
                parameters required or allowed for a State, vary according to type. LFI State
                semantics are described in the Web Annotation Data Model [[annotation-model]] and
                Vocabulary [[annotation-vocab]]. The <code>state</code> parameter is not repeatable
                and is exclusive with respect to the <code>select</code> parameter, meaning the two
                must not appear in the same LFI. Note, as with a Selector, State and Selector
                descriptions can be used in refining other Selectors/States through nesting and
                assuming the proper use of the <code>refinedBy</code> parameter as described
                below.</p>

            <p><code>TimeState</code>: This State type describes how to retrieve a temporally
                appropriate representation when dereferencing the <code>source</code> URL of the
                LFI. The temporal constraint can be a single timestamp, or it can be a date-time
                range. If an appropriate representation was cached, the <code>TimeState</code>
                description may include the URL of the cached copy. The use of
                    <code>TimeState</code> helps avoid retrieval of a resource representation that
                is temporally inappoopiate. For example in a note-taking scenario, a note pertaining
                to a fragment of an article or book chapter (i.e., a Web Publication Resource) may
                only be valid for the version of the article as it was retrievable on a particular
                day and time. Example 13 illustrates the use of a <code>TimeState</code> State.</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 13</span>
                    <span style="text-transform: none">: A <code>TimeState</code></span>
                </div>
                <pre class="nohighlight" id="example13">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(source=https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html,state(type=TimeState,cached=http://example.org/myCopy.html,sourceDate=2015-07-20T13:30:00Z))</pre>
            </div>

            <p><code>HttpRequestState</code>: This State provides the ability to record the HTTP
                Request headers needed to retrieve an appropriate Web Publication Resource
                representation when dereferencing the <code>source</code> URL. Example 14
                illustrates the use of a <code>HttpRequestState</code> State.</p>
            <div class="example">
                <div class="example-title marker">
                    <span>Example 14</span>
                    <span style="text-transform: none">: A <code>HttpRequestState</code></span>
                </div>
                <pre class="nohighlight" id="example14">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(source=https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html,state(type=HttpRequestState,value=Accept:%20application/ld+json))</pre>
            </div>
            <div class="note">The representation retrieved from the server by the original client
                might not be completely determined by request headers alone. For example, the IP
                address of the client might also determine the language of the representation, based
                on the language of the country the user was present in at the time. This State
                should only be used when there is reasonable confidence that the request headers
                provided are sufficient to ensure retrieval of an appropriate representation.</div>
        </section>

        <section id="enh-lfiRefinement">
            <h4>The <code>refinedBy</code> parameter</h4>
            <p>This parameter is optional for both <code>selector</code> and <code>state</code> and
                may be used recursively. The <code>refinedBy</code> parameter allows descriptions of
                Selectors and States to be combined hierarchically and recursively as necessary to
                facilitate identification, location/retrieval, or reference within a Web Publication
                or Web Publication Resource. This method is also appropriate if deemed more reliable
                or accurate. The syntax of <code>refinedBy</code> is functional, i.e.,
                    <code>refinedBy(...)</code> and the parameters allowed are the union of those
                allowed for <code>state</code> and <code>selector</code> parameters, with the value
                of the <code>type</code> parameter distinguishing a refinement that is a State from
                one that is a Selector, as well as identifying which type of Selector or State is
                being used as a refinement. Refinement is done top down, i.e., the top-level
                Selector or State is applied to the representation retrieved first. Then the first
                    <code>refinedBy</code>  Selector or State is applied to this result. Then the next
                    <code>refinedBy</code>  in order is applied to the result of the previous
                    <code>refinedBy</code>, and so on. Example 15 illustrates a
                    <code>TextPositionSelector</code> used to refine an <code>XPathSelector</code>. </p>

            <div class="example">
                <div class="example-title marker">
                    <span>Example 15</span>
                    <span style="text-transform: none">: </span>
                </div>
                <pre class="nohighlight" id="example15">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(source=https://dauwhe.github.io/html-first/MobyDickNav/html/epigraph.html,selector(type=XPathSelector,
              value=/html/body/main/div/div/p[1],refinedBy(type=TextPositionSelector,start=344,end=361)))</pre>
            </div>

        </section>

        <section id="enh-lfiLocate">
            <h5>Identifying a location</h5>
            <p>For some use cases it is desirable to identify a location within a resource rather
                than a content fragment, e.g., the position immediately preceding character 387 of
                the normalized text of the epigraph of the Moby Dick Web Publication. In the context
                of a LFI the semantics of the <code>start</code> and <code>end</code> parameters
                used with <code>TextPositionSelector</code> and <code>DataPositionSelector</code>
                are extended (relative to their definitions in the Web Annotation Data Model) to
                facilitate the identification of a location in a resource text or bytestream rather
                than a content fragment. Specifically: </p>
            <ul>
                <li>the value of <code>start</code> must be =&lt; the value of <code>end</code></li>
                <li>given a text/bytestream that is n characters/bytes in total length, the values
                    of <code>start</code> and <code>end</code> must be =&lt; n</li>
                <li>if the value of the <code>start</code> parameter and the <code>end</code>
                    parameter are the same, the <code>TextPositionSelector</code> /
                        <code>DataPositionSelector</code> identifies the position (i.e., location)
                    in the text/bytestream indicated by the common value</li>
            </ul>
            <p>Thus if the text of a resource was "abcdefghijklmnopqrstuvwxyz", the
                    <code>start</code> was 4, and the <code>end</code> was also 4, then the LFI
                would be identifying the position immediately preceding  the character "e", i.e.,
                the location between "d" and "e". (To identify the content fragment "e", the
                    <code>start</code> would be 4, but the <code>end</code> would be 5.)</p>
            <div class="ednote">Again, this is a novel interpretation of a fragment identifier. We
                need to be confident that there are no modeling inconsistencies or unexpected
                consequences.</div>
        </section>

        <section id="enh-lfiComposite">
            <h4>Multi-resource spans</h4>
            <p>For some use cases it is required to identify a fragment that spans multiple
                contiguous members of a group of resources (e.g., a subset in order of the resources
                which comprise a Web Publication). This is described in an LFI by creating an
                ordered, comma separated list of fragment descriptions, i.e., effectively an ordered
                list of LFIs. The fragments should be logically consecutive (in some reading order),
                all fragment descriptions must include a <code>source</code> parameter, and only the
                first and last fragment descriptions in the list may contain a <code>selector</code>
                or <code>state</code>  parameter. The content described by the first description in
                the list is included as part of the span-fragment, but the content described by the
                last description in the list is not. Example 16 illustrates an LFI identifying a
                fragment of the Moby Dick Web Publication that begins with the 10th paragraph of
                chapter 2, encompasses all of chapter 3, and ends at with the start of the 2nd
                paragraph of chapter 4 (but does not include that paragraph). </p>

            <div class="example">
                <div class="example-title marker">
                    <span>Example 16</span>
                    <span style="text-transform: none">: </span>
                </div>
                <pre class="nohighlight" id="example16">https://dauwhe.github.io/html-first/MobyDick.wpub#locate(
    (source=https://dauwhe.github.io/html-first/MobyDickNav/html/c002.html,selector(type=XPathSelector,
    value=/html/body/main/div/div/p[10]))
	(source=https://dauwhe.github.io/html-first/MobyDickNav/html/c003.html),
	(source=https://dauwhe.github.io/html-first/MobyDickNav/html/c004.html,selector(type=XPathSelector,
    value=/html/body/main/div/div/p[2]))	
	)</pre>
            </div>
            <p>This approach is in general an extension of the <code>RangeSelector</code> except
                that intermediate resources between the beginning of the span and the end of the
                span must be explicitly included to avoid ambiguity (e.g., in case a non-default
                reading order is involved). </p>
        </section>

        <section id="enh-lfiEncoding">
            <h5>URL encoding of LFI</h5>
            <p>All parameter <code>values</code> included in a LFI should be percent encoded
                [[!rfc3986]]; the encoding is a must for characters that may make the fragment
                ambiguous, namely:</p>

            <table>
                <thead>
                    <tr>
                        <td>
                            <strong>character</strong>
                        </td>
                        <td>
                            <strong>code</strong>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>space</td>
                        <td>%20</td>
                    </tr>
                    <tr>
                        <td>
                            <code>=</code>
                        </td>
                        <td>%3D</td>
                    </tr>
                    <tr>
                        <td>
                            <code>,</code>
                        </td>
                        <td>%2C</td>
                    </tr>
                    <tr>
                        <td>
                            <code>#</code>
                        </td>
                        <td>%23</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="enh-preferredUrls">
            <h4>Preferred URLs and URL length</h4>
            <p>For Web Publications, resource addresses (URLs) that appear as the value of a
                    <code>source</code> parameter should appear in the list of Web Publication
                Resources provided in the publication's Infoset. For listed Web Publication
                Resources retrievable from multiple URLs, the listed URL should be used in
                preference to any other. </p>
            <p>User agents typically limit the length of URLs that they will process. When minting a
                LFI, user agents must respect this limit and not create an LFI that results in a URL
                too long to be used.</p>
        </section>
    </section>
</section>			
			
		</section>
		<section id="security">
			<h2>Security</h2>

			<div class="ednote">Placeholder for security issues.</div>
		</section>
		<section id="privacy">
			<h2>Privacy</h2>

			<div class="ednote">Placeholder for privacy issues.</div>
		</section>
		<section id="ack" data-include="common/html/acknowledgements.html" data-include-replace="true"></section>
	</body>
</html>
